 nsClipboard::SelectionGetEvent(GtkClipboard     GtkSelectionData *aSelectionData) int32_t whichClipboard ; GdkAtom selection = gtk_selection_data_get_selection ( aSelectionData ) ; if ( selection == GDK_SELECTION_PRIMARY )  whichClipboard = kSelectionClipboard; if ( selection == GDK_SELECTION_CLIPBOARD )  whichClipboard = kGlobalClipboard; nsCOMPtr < nsITransferable > trans = GetTransferable ( whichClipboard ) ; if ( ! trans )  nsresult rv ; nsCOMPtr < nsISupports > item ; GdkAtom selectionTarget = gtk_selection_data_get_target ( aSelectionData ) ; if ( selectionTarget == gdk_atom_intern ( "STRING" , FALSE ) || selectionTarget == gdk_atom_intern ( "TEXT" , FALSE ) || selectionTarget == gdk_atom_intern ( "COMPOUND_TEXT" , FALSE ) || selectionTarget == gdk_atom_intern ( "UTF8_STRING" , FALSE ) )  rv = trans -> GetTransferData ( "text/unicode" , getter_AddRefs ( item ) , & len ); if ( ! item || NS_FAILED ( rv ) )  nsCOMPtr < nsISupportsString > wideString ; wideString = do_QueryInterface ( item ); if ( ! wideString )  nsAutoString ucs2string ; char * utf8string = ToNewUTF8String ( ucs2string ) ; if ( ! utf8string )  free ( utf8string ); 