static void fd_chr_read(void *opaque) CharDriverState * chr = opaque ; FDCharDriver * s = chr -> opaque ; int size , len ; uint8_t buf [ 1024 ] ; len = sizeof ( buf ); if ( len > s -> max_size )  len = s -> max_size; if ( len == 0 )  size = read ( s -> fd_in , buf , len ); if ( size == 0 )  if ( size > 0 )  qemu_chr_read ( chr , buf , size ); void qemu_chr_read(CharDriverState *s, uint8_t *buf, int len) s -> chr_read ( s -> handler_opaque , buf , len ); 