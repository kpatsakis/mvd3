 nsHtml5TreeBuilder::reconstructTheActiveFormattingElements() if ( listPtr == - 1 )  nsHtml5StackNode * mostRecent = listOfActiveFormattingElements [ listPtr ] ; if ( ! mostRecent || isInStack ( mostRecent ) )  int32_t entryPos = listPtr ; entryPos --; if ( entryPos == - 1 )  if ( ! listOfActiveFormattingElements [ entryPos ] )  if ( isInStack ( listOfActiveFormattingElements [ entryPos ] ) )  while ( entryPos < listPtr )  entryPos ++; nsHtml5StackNode * entry = listOfActiveFormattingElements [ entryPos ] ; nsHtml5StackNode * currentNode = stack [ currentPtr ] ; nsIContentHandle * clone ; if ( currentNode -> isFosterParenting ( ) )  clone = createAndInsertFosterParentedElement ( kNameSpaceID_XHTML , entry -> name , entry -> attributes -> cloneAttributes ( nullptr ) ); clone = createElement ( kNameSpaceID_XHTML , entry -> name , entry -> attributes -> cloneAttributes ( nullptr ) , currentNode -> node ); nsHtml5StackNode * entryClone = new nsHtml5StackNode ( entry -> getFlags ( ) , entry -> ns , entry -> name , clone , entry -> popName , entry -> attributes ) ; push ( entryClone ); listOfActiveFormattingElements [ entryPos ] = entryClone; 