static long CVE_2012_6547_PATCHED___tun_chr_ioctl(struct file *file, unsigned int unsigned long arg, int ifreq_len) struct tun_file * tfile = file -> private_data ; struct tun_struct * tun ; void __user * argp = ( void __user * ) arg ; struct ifreq ifr ; if ( cmd == TUNSETIFF || _IOC_TYPE ( cmd ) == 0x89 )  if ( copy_from_user ( & ifr , argp , ifreq_len ) )  if ( cmd == TUNGETFEATURES )  tun = __tun_get ( tfile ); if ( cmd == TUNSETIFF && ! tun )  if ( ! tun )  switch ( cmd )  if ( arg )  tun -> flags &= ~TUN_PERSIST; tun -> owner = ( uid_t ) arg; tun -> group = ( gid_t ) arg; if ( tun -> dev -> flags & IFF_UP )  tun -> dev -> type = ( int ) arg; tun -> debug = arg; memcpy ( ifr . ifr_hwaddr . sa_data , tun -> dev -> dev_addr , ETH_ALEN ); ifr . ifr_hwaddr . sa_family = tun -> dev -> type; if ( copy_to_user ( argp , & ifr , ifreq_len ) )  DBG ( KERN_DEBUG "%s: set hw address: %pM\n" tun -> dev -> name , ifr . ifr_hwaddr . sa_data ) ret = dev_set_mac_address ( tun -> dev , & ifr . ifr_hwaddr ); return ret ; 