static void mem_add(MemoryListener *listener, MemoryRegionSection *section) AddressSpace * as = container_of ( listener , AddressSpace , dispatch_listener ) ; AddressSpaceDispatch * d = as -> next_dispatch ; MemoryRegionSection now = * section , remain = * section ; if ( now . offset_within_address_space & ~TARGET_PAGE_MASK )  uint64_t left = TARGET_PAGE_ALIGN ( now . offset_within_address_space ) - now . offset_within_address_space ; now . size = int128_min ( int128_make64 ( left ) , now . size ); register_subpage ( d , & now ); static void register_subpage(AddressSpaceDispatch *d, MemoryRegionSection *section) hwaddr base = section -> offset_within_address_space & TARGET_PAGE_MASK ; MemoryRegionSection * existing = phys_page_find ( d -> phys_map , base >> TARGET_PAGE_BITS , next_map . nodes , next_map . sections ) ; assert ( existing -> mr -> subpage || existing -> mr == & io_mem_unassigned ); 