static int megasas_dcmd_pd_get_info(MegasasState *s, MegasasCmd *cmd) size_t dcmd_size = sizeof ( struct mfi_pd_info ) ; uint16_t pd_id ; uint8_t target_id , lun_id ; if ( cmd -> iov_size < dcmd_size )  pd_id = le16_to_cpu ( cmd -> frame -> dcmd . mbox [ 0 ] ); target_id = ( pd_id >> 8 ) & 0xFF; lun_id = pd_id & 0xFF; sdev = scsi_device_find ( & s -> bus , 0 , target_id , lun_id ); if ( sdev )  retval = megasas_pd_get_info_submit ( sdev , pd_id , cmd ); static int megasas_pd_get_info_submit(SCSIDevice *sdev, int MegasasCmd *cmd) struct mfi_pd_info * info = cmd -> iov_buf ; uint8_t cmdbuf [ 6 ] ; if ( ! cmd -> iov_buf )  if ( info -> inquiry_data [ 0 ] != 0x7f && info -> vpd_page83 [ 0 ] == 0x7f )  megasas_setup_inquiry ( cmdbuf , 0x83 , sizeof ( info -> vpd_page83 ) ); static int megasas_setup_inquiry(uint8_t *cdb, int pg, int len) memset ( cdb , 0 , 6 ); cdb [ 0 ] = INQUIRY; cdb [ 1 ] = 0x1; cdb [ 2 ] = pg; cdb [ 3 ] = ( len >> 8 ) & 0xff; cdb [ 4 ] = ( len & 0xff ); 