static void *accept_thread(void *ignore) int as ; socklen_t sinlen ; struct skinnysession * s ; sinlen = sizeof ( sin ); as = accept ( skinnysock , ( struct sockaddr * ) & sin , & sinlen ); if ( as < 0 )  if ( ast_atomic_fetchadd_int ( & unauth_sessions , + 1 ) >= auth_limit )  if ( ! ( s = ast_calloc ( 1 , sizeof ( struct skinnysession ) ) ) )  memcpy ( & s -> sin , & sin , sizeof ( sin ) ); ast_mutex_init ( & s -> lock ); s -> fd = as; if ( time ( & s -> start ) == - 1 )  destroy_session ( s ); static void destroy_session(struct skinnysession *s) if ( cur == s )  if ( s -> fd > - 1 )  close ( s -> fd ); if ( ! s -> device )  ast_mutex_destroy ( & s -> lock ); ast_free ( s ); AST_LIST_INSERT_HEAD ( & sessions , s , list ); if ( ast_pthread_create ( & s -> t , NULL , skinny_session , s ) )  destroy_session ( s ); static void destroy_session(struct skinnysession *s) if ( cur == s )  if ( s -> fd > - 1 )  close ( s -> fd ); if ( ! s -> device )  ast_mutex_destroy ( & s -> lock ); ast_free ( s ); 