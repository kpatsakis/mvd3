static brcmf_cfg80211_scan(struct wiphy *wiphy, struct cfg80211_scan_request *request) struct brcmf_cfg80211_vif * vif ; vif = container_of ( request -> wdev , struct brcmf_cfg80211_vif , wdev ) if ( ! check_vif_up ( vif ) )  static bool check_vif_up(struct brcmf_cfg80211_vif *vif) if ( ! test_bit ( BRCMF_VIF_STATUS_READY , & vif -> sme_state ) )  return false ; return true ; err = brcmf_cfg80211_escan ( wiphy , vif , request , NULL ); static brcmf_cfg80211_escan(struct wiphy *wiphy, struct brcmf_cfg80211_vif struct cfg80211_scan_request struct cfg80211_ssid *this_ssid) struct brcmf_if * ifp = vif -> ifp ; struct brcmf_cfg80211_info * cfg = wiphy_to_cfg ( wiphy ) ; struct cfg80211_ssid * ssids ; bool escan_req ; struct brcmf_ssid_le ssid_le ; u32 SSID_len ; if ( test_bit ( BRCMF_SCAN_STATUS_BUSY , & cfg -> scan_status ) )  if ( test_bit ( BRCMF_SCAN_STATUS_ABORT , & cfg -> scan_status ) )  if ( test_bit ( BRCMF_SCAN_STATUS_SUPPRESS , & cfg -> scan_status ) )  if ( test_bit ( BRCMF_VIF_STATUS_CONNECTING , & ifp -> vif -> sme_state ) )  escan_req = false; if ( request )  ssids = request -> ssids; escan_req = true; ssids = this_ssid; if ( escan_req )  memset ( & ssid_le , 0 , sizeof ( ssid_le ) ); SSID_len = min_t ( u8 , sizeof ( ssid_le . SSID ) , ssids -> ssid_len ); ssid_le . SSID_len = cpu_to_le32 ( 0 ); if ( SSID_len )  memcpy ( ssid_le . SSID , ssids -> ssid , SSID_len ); ssid_le . SSID_len = cpu_to_le32 ( SSID_len ); brcmf_dbg ( INFO , "BUSY: scan for \"%s\" canceled\n" , ssid_le . SSID ); 