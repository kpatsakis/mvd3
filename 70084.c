void VideoSessionConduit* VideoChunk& chunk) layers :: Image * img = chunk . mFrame . GetImage ( ) ; if ( ! img )  if ( ! enabled_ || chunk . mFrame . GetForceBlack ( ) )  int32_t serial = img -> GetSerial ( ) ; if ( serial == last_img_ )  ImageFormat format = img -> GetFormat ( ) ; layers :: GrallocImage * nativeImage = img -> AsGrallocImage ( ) ; if ( nativeImage )  if ( format == ImageFormat :: PLANAR_YCBCR )  layers :: PlanarYCbCrImage * yuv const_cast < layers :: PlanarYCbCrImage * > static_cast < const layers :: PlanarYCbCrImage * > ( img ) ) if ( format == ImageFormat :: CAIRO_SURFACE )  layers :: CairoImage * rgb const_cast < layers :: CairoImage * > static_cast < const layers :: CairoImage * > ( img ) ) gfx :: IntSize size = rgb -> GetSize ( ) ; int half_width = ( size . width + 1 ) >> 1 ; int half_height = ( size . height + 1 ) >> 1 ; int c_size = half_width * half_height ; int buffer_size = YSIZE ( size . width , size . height ) + 2 * c_size ; uint8 * yuv = ( uint8 * ) malloc ( buffer_size ) ; if ( ! yuv )  conduit -> SendVideoFrame ( yuv , buffer_size , size . width , size . height , mozilla :: kVideoI420 , 0 ); free ( yuv ); 