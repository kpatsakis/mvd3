void vncws_handshake_read(void *opaque) VncState * vs = opaque ; uint8_t * handshake_end ; long ret ; size_t want = 4096 - vs -> ws_input . offset ; ret = vnc_client_read_buf ( vs , buffer_end ( & vs -> ws_input ) , want ); if ( ! ret )  vs -> ws_input . offset += ret; handshake_end = ( uint8_t * ) g_strstr_len ( ( char * ) vs -> ws_input . buffer , vs -> ws_input . offset , WS_HANDSHAKE_END ); if ( handshake_end )  buffer_advance ( & vs -> ws_input , handshake_end - vs -> ws_input . buffer + strlen ( WS_HANDSHAKE_END ) ); 