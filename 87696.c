static struct curveType *read_tag_curveType(struct mem_source *src, struct tag_index index, uint32_t tag_id) struct tag * tag = find_tag ( index , tag_id ) ; static struct tag *find_tag(struct tag_index index, uint32_t tag_id) unsigned int i ; struct tag * tag = NULL ; for (i = 0; i < index.count; i++) if ( index . tags [ i ] . signature == tag_id )  return & index . tags [ i ] ; return tag ; if ( tag )  uint32_t len ; return read_curveType ( src , tag -> offset , & len ) ; static struct curveType *read_curveType(struct mem_source *src, uint32_t offset, uint32_t *len) static const uint32_t COUNT_TO_LENGTH [ 5 ] = { 1 , 3 , 4 , 5 , 7 } ; uint32_t type = read_u32 ( src , offset ) ; uint32_t count ; uint32_t i ; if ( type != CURVE_TYPE && type != PARAMETRIC_CURVE_TYPE )  if ( type == CURVE_TYPE )  count = read_u16 ( src , offset + 8 ); static uint16_t read_u16(struct mem_source *mem, size_t offset) if ( offset > mem -> size - 2 )  return 0 ; be16 k ; memcpy ( & k , mem -> buf + offset , sizeof ( k ) ); return be16_to_cpu ( k ) ; if ( count > 4 )  curve = malloc ( sizeof ( struct curveType ) ); if ( ! curve )  curve -> count = count; curve -> type = PARAMETRIC_CURVE_TYPE; for (i=0; i < COUNT_TO_LENGTH[count]; i++) curve -> parameter [ i ] = s15Fixed16Number_to_float ( read_s15Fixed16Number ( src , offset + 12 + i * 4 ) ); static s15Fixed16Number read_s15Fixed16Number(struct mem_source *mem, size_t offset) return read_u32 ( mem , offset ) ; static uint32_t read_u32(struct mem_source *mem, size_t offset) if ( offset > mem -> size - 4 )  be32 k ; memcpy ( & k , mem -> buf + offset , sizeof ( k ) ); return be32_to_cpu ( k ) ; 