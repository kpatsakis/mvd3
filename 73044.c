static int CVE_2009_2768_PATCHED_load_flat_shared_library(int id, struct lib_info *libs) char buf [ 16 ] ; sprintf ( buf , "/lib/lib%d.so" , id ); bprm . filename = buf; bprm . file = open_exec ( bprm . filename ); res = PTR_ERR ( bprm . file ); if ( IS_ERR ( bprm . file ) )  return res ; bprm . cred = prepare_exec_creds ( ); if ( ! bprm . cred )  res = prepare_binprm ( & bprm ); if ( res <= ( unsigned long ) - 4096 )  res = load_flat_file ( & bprm , libs , id , NULL ); abort_creds ( bprm . cred ); allow_write_access ( bprm . file ); fput ( bprm . file ); return ( res ) ; 