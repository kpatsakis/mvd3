static int openpty(int *amaster, int *aslave, char struct termios *termp, struct winsize *winp) mfd = open ( "/dev/ptmx" , O_RDWR | O_NOCTTY ); if ( mfd < 0 )  if ( grantpt ( mfd ) == - 1 || unlockpt ( mfd ) == - 1 )  if ( ( slave = ptsname ( mfd ) ) == NULL )  if ( ( sfd = open ( slave , O_RDONLY | O_NOCTTY ) ) == - 1 )  if ( ioctl ( sfd , I_PUSH , "ptem" ) == - 1 || ( termp != NULL && tcgetattr ( sfd , termp ) < 0 ) )  * amaster = mfd; * aslave = sfd; ioctl ( sfd , TIOCSWINSZ , winp ); if ( sfd != - 1 )  close ( sfd ); close ( mfd ); 